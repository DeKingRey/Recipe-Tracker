<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stardew Recipe Tracker</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
</head>
<body>
    <header>{{ header }}</header>

    <!-- Sets up the navbar for every page-->
    <nav class="navbar">
        <ul>
            <li><a href="/">Home</a></li>
            {% if not current_user.is_authenticated %}
                <li><a href="/register">Register</a></li>
                <li><a href="/login">Login</a></li>
            {% else %}
                <li><a href="/dashboard">Dashboard</a></li>
            {% endif %}

            <!-- Search bar to find recipes -->
            <li>
                <form action=""></form>
                <div class="form-group">
                    <div class="search-wrapper">
                        <label for="search">Search</label>
                        <input type="text" placeholder="Search..." name="search" id="search_input" autocomplete="off"  required>
                        <ul class="suggestions" id="suggestions"></ul> 
                    </div>
                </div>
            </li>
        </ul>
    </nav>

    <main>{% block content %}{% endblock %}</main>

    <footer>&copy;Miguel Monreal 2025</footer> <!-- Sets my footer. -->

    <script>
        const recipes_data = {{ recipes|tojson }} // Gets recipes
        const input = document.getElementById("search_input")
        const suggestions = document.getElementById("suggestions")

        input.addEventListener("input", () => {
            const query = input.value.trim().toLowerCase(); // Gets the users input and correctly formats
            suggestions.innerHTML = ""; 

            if (!query) return;

            // Checks for recipes which include the inputted search
            const matches = recipes_data.filter(recipe =>
                recipe.name.toLowerCase().includes(query)
            );

        // Creates suggestions for each match for user to click
        matches.forEach(match => {
            const li = document.createElement("li");
            li.textContent = match.name;
            li.addEventListener("click", () => {
                input.value = match.name;
                suggestions.innerHTML = "";

                // Redirects to recipe page
                window.location.href = `/recipe/${match.id}`;
            });
            suggestions.appendChild(li);
        });

        input.addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();

                const searchInput = input.value.trim().toLowerCase();
                
                // Finds matching recipe
                const match = recipes_data.find(recipe => 
                    recipe.name.toLowerCase() === searchInput
                );

                // Redirect to recipe page if match, otherwise do nothing
                if (match) {
                    window.location.href = `/recipe/${match.id}`;
                }
            }
        })

        });
    </script>
</body>
</html>